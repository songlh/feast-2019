\section{Implementation}
\label{sec:impl}

From our empirical study in Section~\ref{sec:study},
we observe that a FSM is implemented using a loop 
whose iteration number is not constant  
and the loop conditionally updates a state variable in each iteration. 
Therefore, \Tool{} extracts implemented FSMs from a program in three steps.
First, \Tool{} looks for loops without constant iteration numbers. 
Second, \Tool{} checks whether there are state 
variable updates inside the loops to identify FSM implementations. 
Third, \Tool{} applies a suite 
of static analysis to figure out states ($Q$), 
transition functions ($\delta$), the initial state ($s_0$),
and final states ($F$) for each FSM implementation. 


\subsection{Filtering Loops with Constant Trip Counts}
As we discussed in Section~\ref{sec:study},
a FSM is usually implemented using a loop 
and the loop processes one input in each iteration to decide 
whether to transit to a new state. 
In reality, it is very rare that a FSM can arrive at a final state 
after receiving a constant number of inputs. 
Therefore, given a loop which iterates a constant 
number during every execution, 
the loop is unlikely to be a FSM implementation. 


We mainly leverage scalar evolution analysis~\cite{scalar-1,scalar-2,scalar-3} 
to identify loops whose trip counts are constant. 
Scalar evolution analysis can identify reduction variables inside a loop.
Reduction variables are integer variables, 
whose values are updated 
with a constant delta in each loop iteration. 
For example, variable \texttt{right} is the only reduction 
variable inside the loop in Figure~\ref{fig:cgc-fsm}, 
since its value is incremented by one in every loop iteration.  
When a loop finishes its execution, the value change of a 
reduction variable is a multiplication of 
the iterations executed by the loop. 

After identifying reduction variables inside a loop,
\Tool{} checks whether any exit condition of the loop is to compare 
a reduction variable with a constant number. 
If so, then the loopâ€™s trip count is constant and \Tool{} filter out the loop. 
For example, the only reduction variable \texttt{right} is dereferenced 
in exit conditions of the loop in Figure~\ref{fig:cgc-fsm} 
and it is not compared with a constant number.
Therefore, \Tool{} does not filter out the loop and considers it 
as a potential FSM implementation 
for further analysis. 





\subsection{Pinpointing State Variables}


\subsection{Extracting FSMs}

